namespace = painted_galaxy_fe

event = {
	id = painted_galaxy_fe.1
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_painted_galaxy = yes
	}
	immediate = {
		set_spawn_system_batch = begin
		# global event country hasn't been created yet, just use a random one
		random_country = {
			set_variable = {
				which = painted_galaxy_fe_spawns
				value = 0
			}
			while = {
				limit = {
					check_galaxy_setup_value = {
						setting = num_fallen_empires
						value > painted_galaxy_fe_spawns
					}
				}
				# as of 4.0, add_variable is available, but using change_variable still for easier 3.14 compat
				change_variable = {
					which = painted_galaxy_fe_spawns
					value = 1
				}
				random_list = {
					100 = {
						modifier = {
							factor = 0
							any_country = { has_country_flag = fallen_empire_1 }
						}
						modifier = {
							factor = 99999
							any_country = { has_origin = origin_scion }
						}
						country_event = { id = painted_galaxy_fe.10 }
					}
					100 = {
						modifier = {
							factor = 0
							any_country = { has_country_flag = fallen_empire_2 }
						}
						modifier = {
							factor = 99999
							any_country = { has_origin = origin_scion }
						}
						country_event = { id = painted_galaxy_fe.20 }
					}
					100 = {
						modifier = {
							factor = 0
							any_country = { has_country_flag = fallen_empire_3 }
						}
						country_event = { id = painted_galaxy_fe.30 }
					}
					100 = {
						modifier = {
							factor = 0
							any_country = { has_country_flag = fallen_empire_4 }
						}
						country_event = { id = painted_galaxy_fe.40 }
					}
					100 = {
						modifier = {
							factor = 0
							any_country = { has_country_flag = fallen_empire_machine }
						}
						modifier = {
							factor = 0
							has_synthetic_dawn = no
						}
						country_event = { id = painted_galaxy_fe.50 }
					}
					100 = {
						modifier = {
							factor = 0
							has_global_flag = hive_fe_spawned
						}
						modifier = {
							factor = 0
							has_biogenesis_dlc = no
						}
						modifier = {
							factor = 5
							any_country = {
								is_ai = no
								country_uses_bio_ships = yes
							}
						}
						country_event = { id = painted_galaxy_fe.10 }
					}
				}
			}
			clear_variable = painted_galaxy_fe_spawns
		}
		set_spawn_system_batch = end
	}
}

# spawn materialist fallen empire
country_event = {
	id = painted_galaxy_fe.10
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		painted_galaxy_create_materialist_fe = yes
		last_created_country = {
			set_graphical_culture = fallen_empire_02
			set_city_graphical_culture = fallen_empire_02
			country_event = { id = painted_galaxy_fe.11 }
		}
	}
}

# spawn fallen empire materialist systems:
# - fallen_1
#   - fallen_1_2
#   - fallen_orbitals_1
#     - fallen_col_1
#     - fallen_col_2
#   - fallen_orbitals_2
#     - fallen_col_1
#     - fallen_col_2
country_event = {
	id = painted_galaxy_fe.11
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		random_system = {
			limit = { has_star_flag = painted_galaxy_fe_spawn }
			painted_galaxy_spawn_fe_home_system = { INITIALIZER = fallen_1 }
			last_created_system = {
				painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_1_2 }
				painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_orbitals_1 }
				last_created_system = {
					painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_col_1 }
					painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_col_2 }
				}
				painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_orbitals_2 }
				last_created_system = {
					painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_col_1 }
					painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_col_2 }
				}
			}
		}
	}
}

# spawn spiritualist fallen empire
country_event = {
	id = painted_galaxy_fe.20
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		painted_galaxy_create_spiritualist_fe = yes
		last_created_country = {
			set_graphical_culture = fallen_empire_01
			set_city_graphical_culture = fallen_empire_01
			country_event = { id = painted_galaxy_fe.21 }
		}
	}
}

# spawn fallen empire spiritualist systems:
# - fallen_2
#   - fallen_orbitals_1
#     - fallen_col_1
#     - fallen_col_2
#   - fallen_orbitals_2
#     - fallen_col_1
#     - fallen_col_2
# - fallen_holy_01 (nearby)
# - fallen_holy_02 (nearby)
# - fallen_holy_03 (nearby)
# - fallen_holy_04 (nearby)
# - fallen_shrouded (25% chance)
country_event = {
	id = painted_galaxy_fe.21
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		random_system = {
			limit = { has_star_flag = painted_galaxy_fe_spawn }
			painted_galaxy_spawn_fe_home_system = { INITIALIZER = fallen_2 }
			last_created_system = {
				painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_orbitals_1 }
				last_created_system = {
					painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_col_1 }
					painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_col_2 }
				}
				painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_orbitals_2 }
				last_created_system = {
					painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_col_1 }
					painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_col_2 }
				}
				random_system = {
					limit = {
						has_owner = no
						distance = {
							source = prev
							type = euclidean
							min_distance >= 30
							max_distance <= 100
						}
					}
					spawn_system = { initializer = fallen_holy_01 }
				}
				random_system = {
					limit = {
						has_owner = no
						distance = {
							source = prev
							type = euclidean
							min_distance >= 50
							max_distance <= 150
						}
					}
					spawn_system = { initializer = fallen_holy_02 }
				}
				random_system = {
					limit = {
						has_owner = no
						distance = {
							source = prev
							type = euclidean
							min_distance >= 80
							max_distance <= 200
						}
					}
					spawn_system = { initializer = fallen_holy_03 }
				}
				random_system = {
					limit = {
						has_owner = no
						distance = {
							source = prev
							type = euclidean
							min_distance >= 120
							max_distance <= 250
						}
					}
					spawn_system = { initializer = fallen_holy_04 }
				}
				random = {
					chance = 25
					random_system = {
						limit = {
							distance = {
								source = prev
								type = euclidean
								min_distance >= 0
								max_distance <= 30
							}
						}
						spawn_system = { initializer = fallen_shrouded }
					}
				}
			}
		}
	}
}

# spawn xenophile fallen empire
country_event = {
	id = painted_galaxy_fe.30
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		painted_galaxy_create_xenophile_fe = yes
		last_created_country = {
			set_graphical_culture = fallen_empire_03
			set_city_graphical_culture = fallen_empire_03
			country_event = { id = painted_galaxy_fe.31 }
		}
	}
}

# spawn fallen empire xenophile systems:
# - fallen_3
#   - fallen_xeno_zoo
#   - fallen_orbitals_1
#     - fallen_col_1
#     - fallen_col_2
#   - fallen_orbitals_2
#     - fallen_col_1
#     - fallen_col_2
country_event = {
	id = painted_galaxy_fe.31
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		random_system = {
			limit = { has_star_flag = painted_galaxy_fe_spawn }
			painted_galaxy_spawn_fe_home_system = { INITIALIZER = fallen_3 }
			last_created_system = {
				painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_xeno_zoo }
				painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_orbitals_1 }
				last_created_system = {
					painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_col_1 }
					painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_col_2 }
				}
				painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_orbitals_2 }
				last_created_system = {
					painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_col_1 }
					painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_col_2 }
				}
			}
		}
	}
}

# spawn xenophobe fallen empire
country_event = {
	id = painted_galaxy_fe.40
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		painted_galaxy_create_xenophobe_fe = yes
		last_created_country = {
			set_graphical_culture = fallen_empire_04
			set_city_graphical_culture = fallen_empire_04
			country_event = { id = painted_galaxy_fe.41 }
		}
	}
}

# spawn fallen empire xenophobe systems:
# - fallen_4
#   - fallen_orbitals_1
#     - fallen_col_1
#     - fallen_col_2
#   - fallen_orbitals_2
#     - fallen_col_1
#     - fallen_col_2
#   - fallen_shielded_1
#   - fallen_shielded_2
#   - fallen_shielded_3
country_event = {
	id = painted_galaxy_fe.41
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		random_system = {
			limit = { has_star_flag = painted_galaxy_fe_spawn }
			painted_galaxy_spawn_fe_home_system = { INITIALIZER = fallen_4 }
			last_created_system = {
				painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_orbitals_1 }
				last_created_system = {
					painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_col_1 }
					painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_col_2 }
				}
				painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_orbitals_2 }
				last_created_system = {
					painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_col_1 }
					painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_col_2 }
				}
				painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_shielded_1 }
				painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_shielded_2 }
				painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_shielded_3 }
			}
		}
	}
}

# spawn machine fallen empire
country_event = {
	id = painted_galaxy_fe.50
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		painted_galaxy_create_machine_fe = yes
		last_created_country = {
			set_graphical_culture = fallen_machine_empire_01
			set_city_graphical_culture = fallen_machine_empire_01
			country_event = { id = painted_galaxy_fe.51 }
		}
	}
}

# spawn fallen empire machine systems:
# - fallen_machine
#   - fallen_machine_2
#   - fallen_machine_3
#   - fallen_machine_4
#   - fallen_machine_5
country_event = {
	id = painted_galaxy_fe.51
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		random_system = {
			limit = { has_star_flag = painted_galaxy_fe_spawn }
			painted_galaxy_spawn_fe_home_system = { INITIALIZER = fallen_machine }
			last_created_system = {
				painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_machine_2 }
				painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_machine_3 }
				painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_machine_4 }
				painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_machine_5 }
			}
		}
	}
}

# spawn hive fallen empire
country_event = {
	id = painted_galaxy_fe.60
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		painted_galaxy_create_hive_fe = yes
		last_created_country = {
			set_graphical_culture = biogenesis_01_fallen_empire
			set_city_graphical_culture = biogenesis_01_fallen_empire
			country_event = { id = painted_galaxy_fe.61 }
		}
	}
}


# spawn fallen empire hive systems:
# - fallen_hive_last_thought
#   - fallen_hive_war (conditional)
#     - fallen_hive_war_2
#     - fallen_hive_war_3
#   - fallen_hive_growth (conditional)
#     - fallen_hive_growth_2
#     - fallen_hive_growth_3
#   - fallen_hive_control (conditional)
#     - fallen_hive_control_2
#     - fallen_hive_control_3
country_event = {
	id = painted_galaxy_fe.61
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		random_system = {
			limit = { has_star_flag = painted_galaxy_fe_spawn }
			painted_galaxy_spawn_fe_home_system = { INITIALIZER = fallen_hive_last_thought }
			last_created_system = {
				if = {
					limit = { exists = event_target:fallen_empire_hive_war }
					painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_hive_war }
					last_created_system = {
						painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_hive_war_2 }
						painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_hive_war_3 }
					}
				}
				if = {
					limit = { exists = event_target:fallen_empire_hive_growth }
					painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_hive_growth }
					last_created_system = {
						painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_hive_growth_2 }
						painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_hive_growth_3 }
					}
				}
				if = {
					limit = { exists = event_target:fallen_empire_hive_control }
					painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_hive_control }
					last_created_system = {
						painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_hive_control_2 }
						painted_galaxy_spawn_fe_system = { INITIALIZER = fallen_hive_control_3 }
					}
				}
			}
		}
	}
}
